{% load i18n %}
{% load common_filters %}
{% load common_tags %}

{% load webclient_tags %}

{% comment %}
<!--
  Copyright (C) 2011-2014 University of Dundee & Open Microscopy Environment.
  All rights reserved.

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
{% endcomment %}


<ul>
    <li id="experimenter-0" rel="experimenter{% ifnotequal manager.experimenter.id ome.eventContext.userId %}-locked{% endifnotequal %}" class="jstree-experimenter">
        <a href="#">{% if manager.experimenter %}{{ manager.experimenter.getFullName }}{% else %}{% setting UI_MENU_DROPDOWN.ALL %}{% endif %}</a>
        <ul>
            {% for c in projects %}
            <li id='project-{{ c.id }}' rel="project{% if not c.isOwned %}-locked{% endif %}" class="{{ c.permsCss }} jstree-project" data-fileset="{{ c.id }}">
                <a href="#">{{ c.name|default:"Project"|truncatebefor:"35" }} {% if c.childCount %}
                    <span class="children_count" id="counter-project-{{ c.id }}">{{ c.childCount }}</span>{% endif %}
                </a>
                {% if c.childCount %}
                <ul>
                    {% for d in c.datasets %}
                        <li id='dataset-{{ d.id }}' rel="dataset{% if not d.isOwned %}-locked{% endif %}"
                                class="{{ c.permsCss }}{% if d.childCount %} jstree-closed{% endif %} jstree-dataset"
                                data-fileset="{{ d.id }}">
                            <a href="#">{{ d.name|default:"Dataset"|truncatebefor:"35" }} {% if d.childCount %}
                                <span class="children_count" id="counter-dataset-{{ d.id }}">{{ d.childCount }}
                                    <span id="page-dataset-{{ d.id }}"></span></span>{% endif %}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </li> 
            {% endfor %}

            {% for d in datasets %}
                <li id='dataset-{{ d.id }}' rel="dataset{% if not d.isOwned %}-locked{% endif %}" 
                        class="{{ d.permsCss }}{% if d.childCount %} jstree-closed{% endif %} jstree-dataset"
                        data-fileset="{{ d.id }}">
                    <a href="#">{{ d.name|default:"Dataset"|truncatebefor:"35" }} {% if d.childCount %}
                        <span class="children_count" id="counter-dataset-{{ d.id }}">{{ d.childCount}}
                            <span id="page-dataset-{{ d.id }}"></span></span>{% endif %}
                    </a>
                </li>
            {% endfor %}


            {% for c in screens %}
            <li id='screen-{{ c.id }}' rel="screen{% if not c.isOwned %}-locked{% endif %}" class="{{ c.permsCss }}">
                <a href="#">{{ c.name|default:"Screen"|truncatebefor:"35" }} {% if c.childCount %}
                    <span class="children_count" id="counter-screen-{{ c.id }}">{{ c.childCount }}</span>{% endif %}</a>
                {% if c.childCount %}
                <ul>
                    {% for p in c.plates %}
                        <li id='plate-{{ p.id }}' rel="plate{% if not p.isOwned %}-locked{% endif %}" class="{{ p.permsCss }}">
                            <a href="#">{{ p.name|default:"Plate"|truncatebefor:"35" }}</a>
                            {% if p.plateAcquisitionCount %}
                            <ul>
                                {% for a in p.plateAcquisitions %}
                                    <li id='acquisition-{{ a.id }}' rel="acquisition{% if not a.isOwned %}-locked{% endif %}" class="{{ a.permsCss }}">
                                        <a href="#">{{ a.name|default:"Run"|truncatebefor:"35" }}</a>
                                    </li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </li>
            {% endfor %}


            {% for d in plates %}
            <li id='plate-{{ d.id }}' rel="plate{% if not d.isOwned %}-locked{% endif %}" class="{{ d.permsCss }}">
                <a href="#">{{ d.name|default:"Plate"|truncatebefor:"35" }}</a>
                {% if d.plateAcquisitionCount %}
                <ul>
                    {% for e in d.plateAcquisitions %}
                        <li id='acquisition-{{ e.id }}' rel="acquisition{% if not e.isOwned %}-locked{% endif %}" class="{{ e.permsCss }}">
                            <a href="#">{{ e.name|default:"Run"|truncatebefor:"35" }}</a>
                        </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </li>
            {% endfor %}


            {% if tags %}
            <li rel='tag-section'><a href="#">Tags</a><ul>
                {# TODO Add TagSet support #}
                {# TODO Add locked support #}
                {% for t in tags %}
                    <li id='tag-{{ t.id }}' rel="tag{% if not t.isOwned %}-locked{% endif %}" class="jstree-closed jstree-tag" data-fileset="{{ t.id }}"><a href="#">{{ t.textValue|truncatebefor:"35" }}</a></li>
                {% endfor %}  
            </li></ul>
            {% endif %}

            <li id='orphaned-0' rel="orphaned" {% if orphans %}class="jstree-closed"{% endif %}><a href="#">{% setting UI_TREE_ORPHANED.NAME %}</a></li>
            
        </ul>
    </li>
</ul>




